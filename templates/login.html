<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Log in · Data Science Learning Accelerator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .brand-red { background-color: #a71d15; }
    .text-brand { color:#a71d15; }
    .ring-brand { --tw-ring-color:#a71d15; }
  </style>
</head>
<body class="bg-white text-gray-900 antialiased">
  <header class="bg-[#b21f17] text-white shadow-md">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-3">
        <h1 class="text-lg sm:text-2xl font-semibold tracking-wide">
          Data Science Learning Accelerator
        </h1>
      </div>
    </div>
  </header>

  <section class="bg-gray-100">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
      <h2 class="text-3xl sm:text-4xl font-extrabold">Welcome back</h2>
      <p class="text-gray-600 mt-2">Log in to continue your progress.</p>
    </div>
  </section>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
    <div class="mx-auto w-full max-w-md rounded-2xl border border-gray-200 shadow-md p-6">
      <form action="/login" method="POST" class="space-y-5" novalidate>
        
        {% if error %}
        <div id="client-error" class="rounded-md bg-red-50 p-4 border border-red-200">
          <p class="text-sm text-red-700">{{ error }}</p>
        </div>
        {% else %}
        <div id="client-error" class="hidden rounded-md bg-red-50 p-4 border border-red-200">
          <p class="text-sm text-red-700"></p>
        </div>
        {% endif %}

        {% if message %}
        <div id="flash-message" class="rounded-md bg-green-50 p-4 border border-green-200">
          <p class="text-sm text-green-700">{{ message }}</p>
        </div>
        {% endif %}

        <div>
          <label for="email" class="block text-sm font-medium">Email</label>
          <input id="email" name="email" type="email" autocomplete="email" required
                 class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 shadow-inner outline-none focus:ring-2 focus:ring-yellow-300"
                 placeholder="you@example.com">
        </div>

        <div>
          <label for="password" class="block text-sm font-medium">Password</label>
          <div class="mt-1 relative">
            <input id="password" name="password" type="password" required
                   class="w-full rounded-md border border-gray-300 px-3 py-2 pr-10 shadow-inner outline-none focus:ring-2 focus:ring-yellow-300"
                   placeholder="••••••••">
            <button type="button" id="togglePwd" class="absolute inset-y-0 right-2 my-auto text-sm text-gray-500 hover:text-gray-700">Show</button>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <label class="inline-flex items-center gap-2 text-sm">
            <input type="checkbox" name="remember" class="rounded border-gray-300 text-[#b21f17] focus:ring-[#b21f17]">
            Remember me
          </label>
          <a href="/forgot" class="text-sm text-[#b21f17] hover:underline">Forgot password?</a>
        </div>

        <button type="submit"
                class="w-full rounded-lg bg-[#b21f17] px-4 py-2 text-white font-medium hover:brightness-110 focus:ring-2 focus:ring-offset-2 focus:ring-[#b21f17]">
          Log in
        </button>

        <p class="text-center text-sm text-gray-600">
          New here?
          <a href="/signup" class="text-[#b21f17] hover:underline">Create an account</a>
        </p>
      </form>
    </div>
  </main>

<script>
  // menu toggle
  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  }

  // show/hide password
  const togglePwd = document.getElementById('togglePwd');
  const pwd = document.getElementById('password');
  if (togglePwd && pwd) {
    togglePwd.addEventListener('click', () => {
      const showing = pwd.type === 'text';
      pwd.type = showing ? 'password' : 'text';
      togglePwd.textContent = showing ? 'Show' : 'Hide';
    });
  }

  // === Client-side validation ===
  const loginForm = document.querySelector('form[action="/login"]');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');

  // inline error box (shared with server-side errors)
  const errorBox = document.getElementById('client-error');
  const errorText = errorBox ? errorBox.querySelector('p') : null;

  function isValidEmail(email) {
    // match backend: must have "@" and "."
    return /^[^@]+@[^@]+\.[^@]+$/.test(email);
  }

  // auto-hide success message after 4 seconds
  const flash = document.getElementById('flash-message');
  if (flash) {
    setTimeout(() => {
      flash.classList.add('hidden');
    }, 4000); // 4000ms = 4 seconds
  }


  function isValidPassword(pwdValue) {
    if (!pwdValue || pwdValue.length < 8) return false;
    if (!/[A-Za-z]/.test(pwdValue)) return false;   // at least one letter
    if (!/[\d\W]/.test(pwdValue)) return false;     // at least one digit or special char
    return true;
  }

  function showClientErrors(errors) {
    if (!errorBox || !errorText) return;
    errorText.textContent = errors.join(' ');
    errorBox.classList.remove('hidden');
  }

  if (loginForm && emailInput && passwordInput) {
    loginForm.addEventListener('submit', (e) => {
      const errors = [];

      const emailVal = emailInput.value.trim();
      const pwdVal = passwordInput.value;

      if (!isValidEmail(emailVal)) {
        errors.push('Please enter a valid email address.');
      }

      if (!isValidPassword(pwdVal)) {
        errors.push(
          'Password must be at least 8 characters long, contain at least one letter, and at least one number or special character.'
        );
      }

      if (errors.length > 0) {
        e.preventDefault();
        showClientErrors(errors);
      }
    });
  }
</script>

</body>
</html>